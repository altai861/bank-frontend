(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(t){if(t.ep)return;t.ep=!0;const e=a(t);fetch(t.href,e)}})();const S=document.getElementById("app"),u="https://bank-bankend.onrender.com";let b=localStorage.getItem("accessToken");const g=async()=>{S.innerHTML=`
    <div class="container">
      <h1 align="center">Нэвтрэх</h1>
      <p>Сайн байна уу. Хэрэв та бүртгэлтэй бол өөрийн нэр нууц үгээр нэвтэрч болно. Хэрэв та бүртгэлгүй бол одоо байгаа нэвтрэх хэсгээр өөрийн нэр нууц үгийг зохион нэвтрэх болон бүртгүүлэхийг хамтад нь хийх боломжтой.</p>
      <form id="login-form">
        <label htmlFor="username">Нэр</label>
        <input type="text" id="username" placeholder="Username" required>
        <label htmlFor="password">Нууц үг</label>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Нэвтрэх</button>
      </form>
    </div>
  `,document.getElementById("login-form").addEventListener("submit",async o=>{o.preventDefault();const c=document.getElementById("username").value,a=document.getElementById("password").value,n=await fetch(u+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:a})});if(!n.ok)alert("Нууц үг буруу байна.");else{const t=await n.json();console.log(t.accessToken),localStorage.setItem("accessToken",t.accessToken),b=localStorage.getItem("accessToken"),T()}})},T=async()=>{(await fetch(u+"/bankAccount",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}})).status===403?g():P()},P=async()=>{S.innerHTML=`
    <div class="container">
      <div id="header">
        <div class="header-element" id="my-bank-accounts">Миний данснууд</div>
        <div class="header-element" id="create-account">Данс үүсгэх</div>
        <div class="header-element" id="transactions">Гүйлгээний мэдээлэл</div>
        <div class="header-element" id="make-transaction">Гүйлгээ хийх</div>
        <div><button id="logout-button">Гарах</button></div>
      </div>
      <div id="main-content">
          <h4>Сайн байна уу</h4>
          <p>Танд манай апп-аар өөрийн дансны мэдээлэл болон гүйлгээнийхээ мэдээллийг харах боломжтойгоос гадна шинэ данс нээх (нээсэн данс бүр 100'000₮ ийн үлдэгдэлтэй) болон өөр дансууд руу гүйлгээ хийх боломжтой.</p>
      </div>
    <div> 
  `,document.getElementById("logout-button").addEventListener("click",()=>{R(),T()});const c=document.getElementById("my-bank-accounts"),a=document.getElementById("create-account"),n=document.getElementById("transactions"),t=document.getElementById("make-transaction"),e=document.getElementById("main-content");c.addEventListener("click",async()=>{await j(e)}),a.addEventListener("click",async()=>{await O(e)}),n.addEventListener("click",async()=>{await L(e)}),t.addEventListener("click",async()=>{await D(e)})},j=async o=>{let c=null;const a=await fetch(u+"/bankAccount",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}});if(a.status===403){g();return}else a.status!==404&&(c=await a.json());if(!c)o.innerHTML=`
      <p>Таньд одоогоор банкны данс байхгүй байна.</p>
      <p>Данс нээх хэсэг рүү орж дансаа нээнэ үү.</p>
    `;else{o.innerHTML="";const n=document.createElement("table"),t=document.createElement("thead"),e=document.createElement("tbody"),s=document.createElement("tr");["Дансны дугаар","Банк","Үлдэгдэл"].forEach(r=>{const l=document.createElement("th");l.textContent=r,s.appendChild(l)}),t.appendChild(s),c.forEach(r=>{const l=document.createElement("tr"),m=document.createElement("td");m.textContent=r.bankAccountNumber;const f=document.createElement("td"),p=document.createElement("img");r.bankId==="664c5faef70414a0896a95e6"?p.src=u+"/khanbank.png":r.bankId==="664c5fc4f70414a0896a95e9"?p.src=u+"/golomtbank.jpg":r.bankId==="664c5fd9f70414a0896a95ec"?p.src=u+"/tdbbank.png":r.bankId==="664c5fe9f70414a0896a95ef"&&(p.src=u+"/xacbank.png"),f.appendChild(p);const C=document.createElement("td");C.textContent=`${r.balance} ₮`,l.appendChild(m),l.appendChild(f),l.appendChild(C),e.appendChild(l)}),n.appendChild(t),n.appendChild(e),o.appendChild(n)}},O=async o=>{o.innerHTML=`
    <h2>Данс нээх</h2>
    <form id="new-bank-account-form">
      <label for="bank">Банкаа сонгоно уу</label>
      <select id="bank" name="bank" required>
        <option value="664c5faef70414a0896a95e6">Хаан Банк</option>
        <option value="664c5fc4f70414a0896a95e9">Голомт Банк</option>
        <option value="664c5fd9f70414a0896a95ec">Худалдаа Хөгжилийн Банк</option>
        <option value="664c5fe9f70414a0896a95ef">Хас Банк</option>
      </select>
      <label for="bankAccountNumber">Дансны дугаараа зохионо уу</label>
      <input type="text" id="bankAccountNumber" placeholder="Дансны дугаар" minlength="8" required></input>
      <button type="submit">Данс үүсгэх</button>
    </form>

  `,document.getElementById("new-bank-account-form").addEventListener("submit",async a=>{a.preventDefault();const n=document.getElementById("bank").value,t=document.getElementById("bankAccountNumber").value,e=await fetch(u+"/bankAccount",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({bankAccountNumber:t,bankId:n})});if(e.ok){const s=await e.json();alert(`Таны ${s.bankAccountNumber} дугаартай данс амжилттай үүслээ.`),j(o)}else{const s=await e.json();console.log(s),T()}})},z=(o,c)=>o.filter(a=>{const n=c.toLowerCase();return a.date.toLowerCase().includes(n)||a.senderId.toLowerCase().includes(n)||a.receiverId.toLowerCase().includes(n)||a.transactionValue.toLowerCase().includes(n)||a.userBankId.toLowerCase().includes(n)||a.otherBankId.toLowerCase().includes(n)||a.transactionType.toLowerCase().includes(n)}),L=async o=>{o.innerHTML="";const c=document.createElement("label");c.textContent="Хайлт хийх: ",c.htmlFor="search-bar";const a=document.createElement("input");a.type="text",a.id="search-bar",a.placeholder="Хайх утгаа оруулна уу",o.appendChild(c),o.appendChild(a);let n=null;const t=await fetch(u+"/transaction",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}});if(t.status===403){g();return}else t.status!==404&&(n=await t.json());if(n.length===0)o.innerHTML=`
      <p>Таньд хийсэн гүйлгээ байхгүй байна.</p>
    `;else{const e=document.createElement("div");o.appendChild(e),N(n,e),a.addEventListener("input",s=>{const y=event.target.value;let r=z(n,y);console.log(r),N(r,e)})}},N=(o,c)=>{c.innerHTML="";const a=document.createElement("table");a.className="transactions-table";const n=document.createElement("tr");["Огноо","Шилжүүлсэн дансны банк","Шилжүүлсэн данс","Хүлээн авсан дансны банк","Хүлээн авсан данс","Хэмжээ","Мөнгөн тэмдэгт","Гүйлгээний утга","Гүйлгээний төрөл"].forEach(e=>{const s=document.createElement("td");s.textContent=e,n.appendChild(s)}),a.appendChild(n),o.forEach(e=>{const s=document.createElement("tr"),y=new Date(e.date).toLocaleString(),r=e.transactionType==="Орлого"?"transaction-positive":"transaction-negative";let l;e.transactionType==="Орлого"?(s.className="transaction-positive",l=[y,e.otherBankId,e.senderId,e.userBankId,e.receiverId,e.amount,e.moneyType,e.transactionValue,e.transactionType.charAt(0).toUpperCase()+e.transactionType.slice(1)]):e.transactionType==="Зарлага"&&(s.className="transaction-negative",l=[y,e.userBankId,e.senderId,e.otherBankId,e.receiverId,e.amount,e.moneyType,e.transactionValue,e.transactionType]);for(let m=0;m<l.length;m++){const f=document.createElement("td");if(m===1||m===3){const p=document.createElement("img");l[m]==="664c5faef70414a0896a95e6"?p.src=u+"/khanbank.png":l[m]==="664c5fc4f70414a0896a95e9"?p.src=u+"/golomtbank.jpg":l[m]==="664c5fd9f70414a0896a95ec"?p.src=u+"/tdbbank.png":l[m]==="664c5fe9f70414a0896a95ef"&&(p.src=u+"/xacbank.png"),f.appendChild(p)}else f.textContent=l[m];f.className=r,s.appendChild(f)}a.appendChild(s)}),c.appendChild(a)},D=async o=>{let c;o.innerHTML="";const a=document.createElement("h4");a.textContent="Гүйлгээ хийх";const n=await fetch(u+"/bankAccount",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`}});if(n.status===403){g();return}else if(n.status!==404)c=await n.json();else{alert("Таньд бүртгэлтэй данс байхгүй байна. Та эхлээд дансаа нээнэ үү."),O();return}const t=document.createElement("form"),e=document.createElement("label");e.textContent="Аль данснаас шилжүүлэх";const s=document.createElement("select");s.required=!0,c.forEach(d=>{const i=document.createElement("option");i.value=d.bankAccountNumber;let h;d.bankId==="664c5faef70414a0896a95e6"?h="Хаан Банк":d.bankId==="664c5fc4f70414a0896a95e9"?h="Голомт Банк":d.bankId==="664c5fd9f70414a0896a95ec"?h="Худалдаа Хөгжилийн Банк":d.bankId==="664c5fe9f70414a0896a95ef"&&(h="Хас Банк"),i.textContent=`${h} - Дансны дугаар: "${d.bankAccountNumber}" Үлдэгдэл: ${d.balance}`,s.appendChild(i)}),t.appendChild(e),t.appendChild(s);const y=document.createElement("label");y.textContent="Ямар банкны данс руу мөнгө шилжүүлэх вэ:";const r=document.createElement("select");r.required=!0,[{id:"664c5faef70414a0896a95e6",name:"Хаан Банк"},{id:"664c5fc4f70414a0896a95e9",name:"Голомт Банк"},{id:"664c5fd9f70414a0896a95ec",name:"Худалдаа Хөгжилийн Банк"},{id:"664c5fe9f70414a0896a95ef",name:"Хас Банк"}].forEach(d=>{const i=document.createElement("option");i.value=d.id,i.textContent=d.name,r.appendChild(i)}),t.appendChild(y),t.appendChild(r);const m=document.createElement("label");m.textContent="Хүлээн авагчийн дансны дугаар:";const f=document.createElement("input");f.required=!0,f.type="text";const p=document.createElement("p");let C=!1;t.appendChild(m),t.appendChild(f),t.appendChild(p),f.addEventListener("input",async()=>{const d=f.value,i=r.value,h=await fetch(u+"/findUser",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({accountNumber:d,bankId:i})});if(h.status===403){g();return}else if(h.status!==404){const E=await h.json();console.log(E),p.textContent=`Хүлээн авагчийн нэр: ${E.userName}`,C=!0}else p.textContent="Ийм данстай хэрэглэгч алга.",C=!1});const A=document.createElement("label");A.textContent="Гүйлгээний хэмжээ:";const k=document.createElement("input");k.required=!0,k.type="number",k.min=1,t.appendChild(A),t.appendChild(k);const B=document.createElement("label");B.textContent="Мөнгөн тэмдэгт:";const v=document.createElement("select");v.required=!0,["MNT","USD"].forEach(d=>{const i=document.createElement("option");i.value=d,i.textContent=d,v.appendChild(i)}),t.appendChild(B),t.appendChild(v);const x=document.createElement("label");x.textContent="Гүйлгээний утга:";const I=document.createElement("textarea");I.required=!0,t.appendChild(x),t.appendChild(I);const w=document.createElement("button");w.type="submit",w.textContent="Гүйлгээ хийх",t.appendChild(w),t.addEventListener("submit",async d=>{if(d.preventDefault(),C){const i=s.value;r.value;const h=f.value,E=k.value,M=v.value,$=I.value;if(c.find(H=>H.bankAccountNumber===i).balance<E){alert("Үлдэгдэл хүрэлцэхгүй байна.");return}const q={senderId:i,receiverId:h,amount:parseFloat(E),moneyType:M,transactionValue:$,date:new Date};(await fetch(u+"/transaction",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(q)})).ok?(alert("Гүйлгээ амжилттай хийгдлээ."),await L(o)):(alert("Гүйлгээ амжилтгүй боллоо. Таны дансны үлдэгдэл хүрэхгүй байна."),await L(o))}else{alert("Таны оруулсан данс хүчингүй байна.");return}}),o.appendChild(t)},R=()=>{localStorage.setItem("accessToken",""),b=""};T();
